version: 1.0

source:
  repository_type: GITHUB
  code_repository:
    repository_url: https://github.com/PietroGolfarelli/raven-backend
    source_code_version:
      type: BRANCH
      value: main
    code_configuration:
      configuration_source: REPOSITORY
      # Indichiamo che vogliamo buildare da Dockerfile
      # App Runner (Source) riconosce "DockerfilePath" dentro "BuildCommand" solo se usa buildspec? No.
      # Il campo supportato è "dockerfile_path" all'interno di "image_repository" quando si usa "CONTAINER".
      # Quindi per source-based con Dockerfile, schema corretto è questo sotto:

image_repository:
  image_repository_type: CONTAINER
  image_configuration:
    port: 8080
    runtime_environment_variables:
      QUARKUS_HTTP_PORT: "8080"
      QUARKUS_PROFILE: "prod"
  # Path al Dockerfile nel repo
  dockerfile_path: src/main/docker/Dockerfile.jvm

auto_deployments_enabled: true

instance_configuration:
  cpu: 1024
  memory: 2048

health_check_configuration:
  protocol: HTTP
  path: /q/health/ready
  interval: 10
  timeout: 5
  healthy_threshold: 1
  unhealthy_threshold: 5